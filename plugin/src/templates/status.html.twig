{% include('partials/scripts.html.twig') %}
{% include('partials/styles.html.twig') %}
{% include('partials/services-scripts.html.twig') %}
{% include('partials/breadcrumbs.html.twig') with {'cpSession': cpSession} %}
{% include('partials/navigation.html.twig') with {'cpSession': cpSession, 'active': 'status'} %}

<script>
    window.addEventListener("load", function (e) {
        CrowdSec.initStatus();
        $('#tabs').show();
        CrowdSecServices.initServices();
    });
</script>
<div class="container-fluid ">
    {% include('partials/messages.html.twig') with {'no_exec_func': no_exec_func} %}
    {% include('partials/services.html.twig') with {'restart_needed': restart_needed} %}
    <div class="row crowdsec-table-wrapper">
        <div class="col-md-12">
            <div id="tabs" style="display:none;">
                <ul>
                    <li id="li-status-machines">
                        <a href="#tab-status-machines">Machines</a>
                    </li>
                    <li>
                        <a href="#tab-status-bouncers">Bouncers</a>
                    </li>
                    <li>
                        <a href="#tab-status-collections">Collections</a>
                    </li>
                    <li>
                        <a href="#tab-status-scenarios">Scenarios</a>
                    </li>
                    <li>
                        <a href="#tab-status-parsers">Parsers</a>
                    </li>
                    <li>
                        <a href="#tab-status-postoverflows">Postoverflows</a>
                    </li>
                    <li>
                        <a href="#tab-status-alerts">Alerts</a>
                    </li>
                    <li>
                        <a href="#tab-status-decisions">Decisions</a>
                    </li>
                </ul>
                <div class="loading">
                    <i class="fa fa-spinner fa-spin"></i>Loading, please wait..</div>
                <div id="tab-status-machines">
                    <table id="table-status-machines" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="ip_address">IP Address</th>
                                <th data-column-id="last_update" data-formatter="datetime">Last Update</th>
                                <th data-column-id="validated" data-formatter="yesno" data-searchable="false">Validated?</th>
                                <th data-column-id="version">Version</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-bouncers">
                    <table id="table-status-bouncers" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="ip_address">IP Address</th>
                                <th data-column-id="valid" data-formatter="yesno" data-searchable="false">Valid</th>
                                <th data-column-id="last_pull" data-formatter="datetime">Last API Pull</th>
                                <th data-column-id="type">Type</th>
                                <th data-column-id="version">Version</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-collections">
                    <table id="table-status-collections" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="status">Status</th>
                                <th data-column-id="local_version">Version</th>
                                <th data-column-id="local_path">Local Path</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-scenarios">
                    <table id="table-status-scenarios" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="status">Status</th>
                                <th data-column-id="local_version">Version</th>
                                <th data-column-id="local_path">Path</th>
                                <th data-column-id="description">Description</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-parsers">
                    <table id="table-status-parsers" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="status">Status</th>
                                <th data-column-id="local_version">Version</th>
                                <th data-column-id="local_path">Local Path</th>
                                <th data-column-id="description">Description</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-postoverflows">
                    <table id="table-status-postoverflows" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="name" data-order="asc">Name</th>
                                <th data-column-id="status">Status</th>
                                <th data-column-id="local_version">Version</th>
                                <th data-column-id="local_path">Local Path</th>
                                <th data-column-id="description">Description</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-alerts">
                    <table id="table-status-alerts" class="table table-condensed table-hover table-striped crowdsecTable">
                        <thead>
                            <tr>
                                <th data-column-id="id" data-type="numeric" data-order="asc">ID</th>
                                <th data-column-id="value">Value</th>
                                <th data-column-id="reason">Reason</th>
                                <th data-column-id="country">Country</th>
                                <th data-column-id="as">AS</th>
                                <th data-column-id="decisions">Decisions</th>
                                <th data-column-id="created_at" data-formatter="datetime">Created At</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div id="tab-status-decisions">
                    <table id="table-status-decisions" class="table table-condensed table-hover table-striped crowdsecTable">
                        <div id="decisions-disclaimer">
                            <p>Note: the decisions coming from the CAPI (signals collected by the CrowdSec users)
                                																																								     do not appear here.
                                																																								        To show them, use
                                <code>cscli decisions list -a</code>
                                in a shell.</p>
                        </div>
                        <thead>
                            <tr>
                                <th data-column-id="id" data-identifier="true" data-type="numeric" data-order="asc">ID</th>
                                <th data-column-id="source">Source</th>
                                <th data-column-id="scope_value">Scope:Value</th>
                                <th data-column-id="reason">Reason</th>
                                <th data-column-id="action">Action</th>
                                <th data-column-id="country">Country</th>
                                <th data-column-id="as">AS</th>
                                <th data-column-id="events_count" data-type="numeric">Events</th>
                                <th data-column-id="expiration" data-formatter="duration">Expiration</th>
                                <th data-column-id="alert_id" data-type="numeric">Alert&nbsp;ID</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr></tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!-- Modal popup to confirm decision deletion -->
            <div class="modal fade" id="remove-decision-modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="modalLabel">Modal Title</h4>
                        </div>
                        <div class="modal-body">
                            Modal content...
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="nowarn no-confirm btn btn-secondary" data-dismiss="modal">No, 
                                																																								                cancel</button>
                            <button type="button" class="nowarn no-confirm btn btn-danger" data-dismiss="modal" id="remove-decision-confirm">Yes, 
                                																																								                delete</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>
